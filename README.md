# ğŸ¦„ {cache}
<p align="center">
  <a href="#">
    <img src="https://github.com/orca-zhang/cache/raw/master/logo.svg">
  </a>
</p>

<p align="center">
  <a href="https://github.com/orca-zhang/cache/blob/master/LICENSE">
    <img src="https://img.shields.io/badge/license-MIT-brightgreen.svg?style=flat">
  </a>
  <a href="https://goreportcard.com/badge/github.com/orca-zhang/cache">
    <img src="https://goreportcard.com/badge/github.com/orca-zhang/cache">
  </a>
<a href="https://app.fossa.com/projects/git%2Bgithub.com%2Forca-zhang%2Fcache?ref=badge_shield" alt="FOSSA Status"><img src="https://app.fossa.com/api/projects/git%2Bgithub.com%2Forca-zhang%2Fcache.svg?type=shield"/></a>
</p>
<p align="center">Extremely easy, fast, concurrency-safe and support distributed consistency.</p>


[![FOSSA Status](https://app.fossa.com/api/projects/git%2Bgithub.com%2Forca-zhang%2Fcache.svg?type=large)](https://app.fossa.com/projects/git%2Bgithub.com%2Forca-zhang%2Fcache?ref=badge_large)

# ç‰¹æ€§

- âœ… ä»£ç é‡<300è¡Œã€30så®Œæˆæ¥å…¥
- ğŸš€ é«˜æ€§èƒ½ã€æç®€è®¾è®¡ã€å¹¶å‘å®‰å…¨
- ğŸ‰ åŒæ—¶æ”¯æŒ`LRU` å’Œ `LFU-2`æ¨¡å¼
- ğŸ¦– é¢å¤–å°ç»„ä»¶æ”¯æŒåˆ†å¸ƒå¼ä¸€è‡´æ€§ï¼ˆWIPï¼‰

## å¦‚ä½•ä½¿ç”¨

- å¼•å…¥åŒ…ï¼ˆé¢„è®¡5ç§’ï¼‰
``` go
import (
    "time"

    "github.com/orca-zhang/cache"
)
```

- å®šä¹‰å®ä¾‹ï¼ˆé¢„è®¡5ç§’ï¼‰
> å¯ä»¥æ”¾ç½®åœ¨ä»»æ„ä½ç½®ï¼ˆå…¨å±€ä¹Ÿå¯ä»¥ï¼‰ï¼Œå»ºè®®å°±è¿‘å®šä¹‰
``` go
var c = cache.NewLRUCache(16, 200, 10 * time.Second)
```

- è®¾ç½®ç¼“å­˜ï¼ˆé¢„è®¡5ç§’ï¼‰
``` go
c.Put("uid1", o) // oå¯ä»¥æ˜¯ä»»æ„å˜é‡ï¼Œä¸€èˆ¬æ˜¯å¯¹è±¡æŒ‡é’ˆï¼Œå­˜æ”¾å›ºå®šçš„ä¿¡æ¯ï¼Œæ¯”å¦‚*UserInfo
```

- æŸ¥è¯¢ç¼“å­˜ï¼ˆé¢„è®¡5ç§’ï¼‰
``` go
if v, ok := c.Get("uid1"); ok {
    return v.(*UserInfo) // ä¸ç”¨ç±»å‹æ–­è¨€ï¼Œå’±ä»¬è‡ªå·±æ§åˆ¶ç±»å‹
}
// å¦‚æœå†…å­˜ç¼“å­˜æ²¡æœ‰æŸ¥è¯¢åˆ°ï¼Œä¸‹é¢å†å›æºæŸ¥redis/db
```

- åˆ é™¤ç¼“å­˜ï¼ˆé¢„è®¡5ç§’ï¼‰
> åœ¨ä¿¡æ¯å‘ç”Ÿå˜åŒ–çš„åœ°æ–¹
``` go
c.Del("uid1")
```

- ä¸‹è½½åŒ…ï¼ˆé¢„è®¡5ç§’ï¼‰

> égo modulesæ¨¡å¼ï¼š\
> sh>  ```go get -u github.com/orca-zhang/cache```

> go modulesæ¨¡å¼ï¼š\
> sh>  ```go mod tidy && go mod download```

- è¿è¡Œå§
> ğŸ‰ å®Œç¾æå®š ğŸš€ æ€§èƒ½ç›´æ¥æå‡Xå€ï¼\
> sh>  ```go run <ä½ çš„main.goæ–‡ä»¶>```

## å‚æ•°è¯´æ˜

- `NewLRUCache`
  - ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¡¶çš„ä¸ªæ•°ï¼Œç”¨æ¥åˆ†æ•£é”çš„ç²’åº¦ï¼Œæ¯ä¸ªæ¡¶éƒ½ä¼šä½¿ç”¨ç‹¬ç«‹çš„é”
    - ä¸ç”¨æ‹…å¿ƒï¼Œéšæ„è®¾ç½®ä¸€ä¸ªå°±å¥½ï¼Œ`cache`ä¼šæ‰¾ä¸€ä¸ªç­‰äºæˆ–è€…ç•¥å¤§äºè¾“å…¥å¤§å°çš„2çš„å¹‚æ¬¡çš„æ•°å­—ï¼Œåé¢ä¾¿äºæ©ç è®¡ç®—
  - ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¯ä¸ªæ¡¶æ‰€èƒ½å®¹çº³çš„itemä¸ªæ•°ä¸Šé™
    - æ„å‘³ç€`cache`å…¨éƒ¨å†™æ»¡çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥æœ‰`ç¬¬ä¸€ä¸ªå‚æ•°âœ–ï¸ç¬¬äºŒä¸ªå‚æ•°`ä¸ªitem
  - ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ¯ä¸ªitemçš„è¿‡æœŸæ—¶é—´

## æœ€ä½³å®è·µ

- å¤æ‚å¯¹è±¡ä¼˜å…ˆå­˜æ”¾æŒ‡é’ˆï¼ˆæ³¨æ„âš ï¸ï¼šä¸€æ—¦æ”¾è¿›å»ä¸è¦å†ä¿®æ”¹å…¶å­—æ®µï¼Œå³ä½¿æ‹¿å‡ºæ¥ä¹Ÿæ˜¯ï¼Œå› ä¸ºitemæœ‰å¯èƒ½è¢«å…¶ä»–äººåŒæ—¶è®¿é—®ï¼‰
  - å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œè§£å†³æ–¹æ¡ˆï¼šå–å‡ºå­—æ®µæ¯ä¸ªå•ç‹¬èµ‹å€¼ï¼Œæˆ–è€…ç”¨copieråšä¸€æ¬¡æ·±æ‹·è´ååœ¨å‰¯æœ¬ä¸Šä¿®æ”¹
- ä¹Ÿå¯ä»¥å­˜æ”¾å¯¹è±¡ï¼ˆç›¸å¯¹äºä¸Šä¸€ä¸ªæ€§èƒ½å·®ä¸€äº›ï¼Œå› ä¸ºæ‹¿å‡ºå»æœ‰æ‹·è´ï¼‰
- ç¼“å­˜çš„å¯¹è±¡å°½å¯èƒ½è¶Šå¾€ä¸šåŠ¡ä¸Šå±‚è¶Šå¤§è¶Šå¥½ï¼ˆèŠ‚çœå†…å­˜æ‹¼è£…å’Œç»„ç»‡æ—¶é—´ï¼‰
- å¦‚æœä¸æƒ³å› ä¸ºç±»ä¼¼éå†çš„è¯·æ±‚æŠŠçƒ­æ•°æ®åˆ·æ‰ï¼Œå¯ä»¥æ”¹ç”¨[`LFU`æ¨¡å¼](#LFUæ¨¡å¼)ï¼Œè™½ç„¶æœ‰10%+çš„æŸè€—ï¼ˆ[ä»€ä¹ˆæ˜¯LFU](#ä»€ä¹ˆæ˜¯LFU)ï¼‰
- ä¸€ä¸ªå®ä¾‹å¯ä»¥å­˜å‚¨å¤šç§ç±»å‹çš„å¯¹è±¡ï¼Œè¯•è¯•keyæ ¼å¼åŒ–çš„æ—¶å€™åŠ ä¸Šå‰ç¼€ï¼Œç”¨å†’å·åˆ†å‰²
- å¹¶å‘è®¿é—®é‡å¤§çš„åœºæ™¯ï¼Œè¯•è¯•`256`ã€`1024`ä¸ªæ¡¶ï¼Œç”šè‡³æ›´å¤š

## ç‰¹åˆ«åœºæ™¯

- ç©ºç¼“å­˜å“¨å…µï¼ˆä¸å­˜åœ¨çš„å¯¹è±¡ä¸ç”¨å†å›æºï¼‰
``` go
// è®¾ç½®çš„æ—¶å€™ç›´æ¥ç»™`nil`å°±å¥½
c.Put("uid1", nil)
```

``` go
// è¯»å–çš„æ—¶å€™ï¼Œä¹Ÿå’Œæ­£å¸¸å·®ä¸å¤š
if v, ok := c.Get("uid1"); ok {
  if v == nil { // æ³¨æ„âš ï¸ï¼šè¿™é‡Œéœ€è¦åˆ¤æ–­æ˜¯ä¸æ˜¯ç©ºç¼“å­˜å“¨å…µ
    return nil // æ˜¯ç©ºç¼“å­˜å“¨å…µï¼Œé‚£å°±è¿”å›æ²¡æœ‰ä¿¡æ¯æˆ–è€…ä¹Ÿå¯ä»¥è®©`uid1`ä¸å‡ºç°åœ¨å¾…å›æºåˆ—è¡¨é‡Œ
  }
  return v.(*UserInfo)
}
// å¦‚æœå†…å­˜ç¼“å­˜æ²¡æœ‰æŸ¥è¯¢åˆ°ï¼Œä¸‹é¢å†å›æºæŸ¥redis/db
```

- LFUæ¨¡å¼ï¼ˆ[ä»€ä¹ˆæ˜¯LFU](#ä»€ä¹ˆæ˜¯LFU)ï¼‰
> ç›´æ¥åœ¨`NewLRUCache()`åé¢è·Ÿ`.LFU(<num>)`å°±å¥½ï¼Œå‚æ•°`<num>`ä»£è¡¨LFUçƒ­é˜Ÿåˆ—çš„itemä¸Šé™ä¸ªæ•°ï¼ˆæ¯ä¸ªæ¡¶ï¼‰
``` go
var c = cache.NewLRUCache(16, 200, 10 * time.Second).LFU(1024)
```

# ä¸å¸Œæœ›ä½ ç™½æ¥

- å®¢å®˜ï¼Œæ—¢ç„¶æ¥äº†ï¼Œå­¦ç‚¹ä¸œè¥¿å†èµ°å§ï¼
- æˆ‘æƒ³å°½åŠ›è®©ä½ æ˜ç™½`cache`åšäº†å•¥ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåš

## ä»€ä¹ˆæ˜¯æœ¬åœ°å†…å­˜ç¼“å­˜

---
    L1 ç¼“å­˜å¼•ç”¨ .................... 0.5 ns
    åˆ†æ”¯é”™è¯¯é¢„æµ‹ ...................... 5 ns
    L2 ç¼“å­˜å¼•ç”¨ ...................... 7 ns
    äº’æ–¥é”/è§£é” ...................... 25 ns
    ä¸»å­˜å‚¨å™¨å¼•ç”¨ .................... 100 ns
    ä½¿ç”¨ Zippy å‹ç¼© 1K å­—èŠ‚ ........3,000 ns =   3 Âµs
    é€šè¿‡ 1 Gbps ç½‘ç»œå‘é€ 2K å­—èŠ‚... 20,000 ns =  20 Âµs
    ä»å†…å­˜ä¸­é¡ºåºè¯»å– 1 MB ........ 250,000 ns = 250 Âµs
    åŒä¸€æ•°æ®ä¸­å¿ƒå†…çš„å¾€è¿”........... 500,000 ns = 0.5 ms
    å‘é€æ•°æ®åŒ… åŠ å·<->è·å…° .... 150,000,000 ns = 150 ms

- ä»ä¸Šè¡¨å¯ä»¥çœ‹å‡ºï¼Œå†…å­˜è®¿é—®å’Œç½‘ç»œè®¿é—®(åŒæ•°æ®ä¸­å¿ƒ)å·®ä¸å¤šæ˜¯ä¸€åƒåˆ°ä¸€ä¸‡å€çš„å·®è·ï¼
- æ›¾ç»é‡åˆ°ä¸æ­¢ä¸€ä¸ªå·¥ç¨‹å¸ˆï¼šâ€œç¼“å­˜ï¼Ÿä¸Šredisâ€ï¼Œä½†æˆ‘æƒ³è¯´ï¼Œredisä¸æ˜¯ä¸‡é‡‘æ²¹ï¼ŒæŸäº›ç¨‹åº¦ä¸Šè®²ï¼Œç”¨å®ƒè¿˜æ˜¯å™©æ¢¦ï¼ˆå½“ç„¶æˆ‘è¯´çš„æ˜¯ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜...ğŸ˜„ï¼‰
- å› ä¸ºå†…å­˜æ“ä½œéå¸¸å¿«ï¼Œç›¸å¯¹äºredis/dbä½ åŸºæœ¬å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œæ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªæŸ¥è¯¢æ¥å£ï¼Œæˆ‘ä»¬æŠŠç»“æœç¼“å­˜1ç§’ï¼Œä¹Ÿå°±æ˜¯1ç§’å†…ä¸ä¼šè¯·æ±‚redis/dbï¼Œå¦‚æœæ¥å£çš„qpsæ˜¯1000ï¼Œé‚£redis/dbçš„è¯·æ±‚æ•°é‡é™ä½åˆ°äº†1/1000ï¼ˆç†æƒ³æƒ…å†µï¼‰ï¼Œæ„å‘³ç€è®¿é—®redis/dbéƒ¨åˆ†çš„æ€§èƒ½æå‡äº†1000å€ï¼Œå¬ä¸Šå»æ˜¯ä¸æ˜¯å¾ˆæ£’ï¼Ÿ
- ç»§ç»­çœ‹ï¼Œä½ ä¼šçˆ±ä¸Šå¥¹çš„ï¼ï¼ˆå½“ç„¶ä¹Ÿå¯èƒ½æ˜¯ä»–ï¼Œäº¦æˆ–è€…æ˜¯ç‰ ï¼Œahahaï¼‰

### ä½¿ç”¨åœºæ™¯ï¼Œè§£å†³ä»€ä¹ˆé—®é¢˜

- é«˜å¹¶å‘å¤§æµé‡åœºæ™¯
  - ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼ˆæ¯”å¦‚äººæ°”æœ€é«˜çš„ç›´æ’­é—´ï¼‰
  - çªå‘QPSå‰Šå³°ï¼ˆæ¯”å¦‚ä¿¡æ¯æµä¸­çªå‘æ–°é—»ï¼‰
- èŠ‚çœæˆæœ¬
  - å•æœºåœºæ™¯ï¼ˆä¸éƒ¨ç½²redisã€memcacheä¹Ÿèƒ½å¿«é€Ÿæå‡qpsä¸Šé™ï¼‰
  - rediså’Œdbå®ä¾‹é™é…ï¼ˆèƒ½æ‹¦æˆªå¤§éƒ¨åˆ†è¯·æ±‚ï¼‰
- ç¼“å­˜ä¸æ€ä¹ˆä¼šå˜åŒ–çš„æ•°æ®ï¼ˆå†™å°‘è¯»å¤šï¼‰
  - æ¯”å¦‚é…ç½®ç­‰ï¼ˆè¿™ç±»æ•°æ®ä½¿ç”¨åœ°æ–¹å¤šï¼Œä¼šæœ‰æ”¾å¤§æ•ˆåº”ï¼Œå¾ˆå¤šæ—¶å€™å¯èƒ½ä¼šå› ä¸ºè¿™äº›é…ç½®çƒ­keyå¯¹rediså®ä¾‹çš„è§„æ ¼è¯¯åˆ¤ï¼Œéœ€è¦å•ç‹¬ä¸ºå®ƒä»¬å‡é…ï¼‰
- ç¼“å­˜å¯ä»¥å®¹å¿çŸ­æš‚ä¸ä¸€è‡´çš„æ•°æ®
  - ä¿¡æ¯æŸ¥è¯¢ï¼ˆç”¨æˆ·å¤´åƒã€æ˜µç§°ã€å•†å“åº“å­˜(å®é™…ä¸‹å•ä¼šåœ¨dbå†æ¬¡æ£€æŸ¥)ç­‰ï¼‰
  - é…ç½®å»¶è¿Ÿç”Ÿæ•ˆï¼ˆè¿‡æœŸæ—¶é—´10ç§’ï¼Œé‚£æœ€å¤š10ç§’ç”Ÿæ•ˆï¼‰

## è®¾è®¡æ€è·¯

> æºè‡ª[lrucache](http://github.com/orca-zhang/lrucache)ï¼Œ`cache`æ˜¯å…¶å‡çº§ç‰ˆæœ¬

- æœ€ä¸‹å±‚æ˜¯ç”¨åŸç”Ÿmapå’Œå­˜åŒé“¾è¡¨çš„```node```å®ç°çš„æœ€åŸºç¡€`LRU`ï¼ˆæœ€ä¹…æœªè®¿é—®ï¼‰
  - PSï¼šæˆ‘å®ç°çš„å…¶ä»–ç‰ˆæœ¬ï¼ˆ[go](https://github.com/orca-zhang/lrucache) / [C++](https://github.com/ez8-co/linked_hash) / [js](https://github.com/orca-zhang/cache.js)ï¼‰åœ¨leetcodeéƒ½æ˜¯è¶…è¶Š100%çš„è§£æ³•
- ç¬¬2å±‚åŒ…äº†åˆ†æ¡¶ç­–ç•¥ã€å¹¶å‘æ§åˆ¶ã€è¿‡æœŸæ§åˆ¶ï¼ˆä¼šè‡ªåŠ¨é€‚é…ç­‰äºæˆ–è€…ç•¥å¤§äºè¾“å…¥å¤§å°çš„2çš„å¹‚æ¬¡ä¸ªæ¡¶ï¼Œä¾¿äºæ©ç è®¡ç®—ï¼‰
- ç¬¬2.5å±‚ç”¨å¾ˆç®€å•çš„æ–¹å¼å®ç°äº†`LFU`ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰èƒ½åŠ›ï¼Œä»£ç ä¸è¶…è¿‡20è¡Œï¼Œç›´æ¥çœ‹æºç ï¼ˆæœå…³é”®è¯`lfu`ï¼‰

### ä»€ä¹ˆæ˜¯LRU
- æœ€ä¹…æœªè®¿é—®çš„ä¼˜å…ˆé©±é€
- æ¯æ¬¡è¢«è®¿é—®ï¼Œitemä¼šè¢«åˆ·æ–°åˆ°é˜Ÿåˆ—çš„æœ€å‰é¢
- é˜Ÿåˆ—æ»¡åå†æ¬¡å†™å…¥æ–°itemï¼Œä¼˜å…ˆé©±é€é˜Ÿåˆ—æœ€åé¢ã€ä¹Ÿå°±æ˜¯æœ€ä¹…æœªè®¿é—®çš„item

### ä»€ä¹ˆæ˜¯LFU
- æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ä¼˜å…ˆè¢«é©±é€
- è¿™é‡Œå°±æ¶‰åŠåˆ°è®¿é—®é¢‘ç‡ä¹Ÿå°±æ˜¯æ¬¡æ•°çš„æ¦‚å¿µï¼Œå…¶ä¸­ä¸€ç§æ˜¯`LFU-K`ï¼Œä¹Ÿå°±æ˜¯å°‘äºKæ¬¡è®¿é—®çš„ç”¨å•ç‹¬çš„`LRU`é˜Ÿåˆ—å­˜æ”¾ï¼Œè¶…è¿‡Kæ¬¡çš„å¦å¤–å­˜æ”¾
- ä¸»è¦ä¼˜åŒ–çš„åœºæ™¯æ˜¯æ¯”å¦‚ä¸€äº›éå†ç±»å‹çš„æŸ¥è¯¢ï¼Œæ‰¹é‡åˆ·ç¼“å­˜ä»¥åï¼Œå¾ˆå®¹æ˜“æŠŠä¸€äº›æœ¬æ¥è¾ƒçƒ­çš„itemç»™é©±é€æ‰
- ä¸ºäº†å®ç°ç®€å•ï¼Œæˆ‘ä»¬è¿™é‡Œå®ç°çš„æ˜¯`LFU-2`ï¼Œä¹Ÿå°±æ˜¯ç¬¬2æ¬¡è®¿é—®å°±æ”¾åˆ°çƒ­é˜Ÿåˆ—é‡Œï¼Œå¹¶ä¸è®°å½•è®¿é—®æ¬¡æ•°
- ä¸»è¦ä¼˜åŒ–çš„æ˜¯çƒ­keyçš„ç¼“å­˜å‘½ä¸­ç‡

### åˆ†å¸ƒå¼ä¸€è‡´æ€§ç»„ä»¶ï¼ˆWIP - å¼€å‘ä¸­ï¼‰

- è¿™é‡Œå…¶å®ç®€å•çš„åˆ©ç”¨äº†redisçš„pubsubåŠŸèƒ½
- åˆ é™¤itemçš„æ—¶å€™ï¼Œå®ƒä¼šé€šçŸ¥åˆ°å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹
- æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œå®ƒåªæ˜¯ç¼©å°ä¸ä¸€è‡´æ—¶é—´çª—å£çš„ä¸€ä¸ªæ–¹å¼ï¼ˆæœ‰ç½‘ç»œå»¶è¿Ÿä¸”ä¸ä¿è¯ä¸€å®šå®Œæˆï¼‰
- éœ€è¦æ³¨æ„âš ï¸ä»¥ä¸‹åœºæ™¯ä¼šé™çº§ï¼ˆæ—¶é—´çª—å£å˜å¤§ï¼‰ï¼š
  - redisé”™è¯¯ã€ç½‘ç»œé”™è¯¯ã€æ¶ˆè´¹goroutine panic
  - æœªåœ¨æ‰€æœ‰èŠ‚ç‚¹ç”Ÿæ•ˆçš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚
    - å·²ä½¿ç”¨`cache`ä½†é¦–æ¬¡æ·»åŠ æ­¤æ’ä»¶
    - æ–°å¢çš„itemæˆ–è€…åˆ é™¤æ“ä½œ

### å…³äºæ€§èƒ½

- é‡Šæ”¾é”ä¸ç”¨deferï¼ˆå•æ¥å£æ€§èƒ½å·®20å€ï¼Œçœ‹åˆ°æœ‰å®£ç§°`é«˜æ€§èƒ½`è¿˜ç”¨deferçš„ï¼Œç›´æ¥passå§ï¼‰
- ä¸ç”¨å¼‚æ­¥æ¸…ç†ï¼ˆæ²¡æ„ä¹‰ï¼Œåˆ†æ•£åˆ°å†™æ—¶é©±é€æ›´åˆç†ï¼Œä¸æ˜“æŠ–åŠ¨ï¼‰
- æ²¡æœ‰ç”¨å†…å­˜å®¹é‡æ¥æ§åˆ¶ï¼ˆå•ä¸ªitemçš„å¤§å°ä¸€èˆ¬éƒ½æœ‰é¢„ä¼°å¤§å°ï¼Œç®€å•æ§åˆ¶ä¸ªæ•°å³å¯ï¼‰
- åˆ†æ¡¶ç­–ç•¥ï¼Œè‡ªåŠ¨é€‰æ‹©2çš„å¹‚æ¬¡ä¸ªæ¡¶ï¼ˆåˆ†æ•£é”ç«äº‰ï¼Œ2çš„å¹‚æ¬¡æ©ç æ“ä½œæ›´å¿«ï¼‰
- keyç”¨stringç±»å‹ï¼ˆå¯æ‰©å±•æ€§å¼ºï¼›è¯­è¨€å†…å»ºæ”¯æŒå¼•ç”¨ï¼Œæ›´çœå†…å­˜ï¼‰
- ä¸ç”¨è™šè¡¨å¤´ï¼ˆè™½ç„¶ç»•è„‘ä¸€äº›ï¼Œä½†æ˜¯æœ‰20%å·¦å³æå‡ï¼‰
- é€‰æ‹©`LFU-2`å®ç°`LFU-K`ï¼ˆå®ç°ç®€å•ï¼Œè¿‘ä¹æ²¡æœ‰é¢å¤–æŸè€—ï¼‰
- æ²¡ç”¨æ•´å—å†…å­˜ï¼ˆå†™æ»¡åå¤ç”¨ä»¥å‰çš„å†…å­˜æ•ˆæœä¹Ÿå¾ˆå¥½ï¼Œæ•´å—æ–¹å¼å°è¯•è¿‡æå‡ä¸å¤§ã€ä½†å¯è¯»æ€§å¤§å¤§é™ä½ï¼‰
- å¯ä»¥ç›´æ¥å­˜æŒ‡é’ˆï¼ˆä¸ç”¨åºåˆ—åŒ–ï¼Œå¦‚æœä½¿ç”¨`[]byte`é‚£ä¼˜åŠ¿å¤§å¤§é™ä½ï¼‰

### å…³äºGC

- å°±åƒæˆ‘åœ¨C++ç‰ˆæ€§èƒ½å‰–æå™¨é‡Œæåˆ°çš„[æ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªå±‚æ¬¡](https://github.com/ez8-co/ezpp#æ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªå±‚æ¬¡)ï¼Œå•ä»ä¸€ä¸ªå±‚é¢è€ƒè™‘æ€§èƒ½ä¸é«˜æ˜
- ã€Šç¬¬ä¸‰å±‚æ¬¡ã€‹é‡Œæœ‰ä¸€å¥â€œæ²¡æœ‰æ¯”ä¸å­˜åœ¨çš„ä¸œè¥¿æ€§èƒ½æ›´å¿«çš„äº†â€ï¼ˆç±»ä¼¼å¥¥å¡å§†å‰ƒåˆ€ï¼‰ï¼Œèƒ½ç æ‰çš„ä¸œè¥¿ä¸€å®šä¸è¦æƒ³ç€ä¼˜åŒ–
- æ¯”å¦‚ä¸ºäº†å‡å°‘GCå¤§å—åˆ†é…å†…å­˜ï¼Œå´æä¾›`[]byte`çš„å€¼å­˜å‚¨ï¼Œæ„å‘³ç€å¿…é¡»å…ˆåºåˆ—åŒ–å†æ‹·è´ï¼Œé¢å¤–æ“ä½œè™½ä¸åœ¨æ€§èƒ½æŒ‡æ ‡é‡Œï¼Œå®é™…ç”¨è¿˜æ˜¯è¦ç®—
- å¦‚æœåºåˆ—åŒ–çš„éƒ¨åˆ†å¯ä»¥å¤ç”¨ç”¨åœ¨åè®®å±‚æ‹¼æ¥ï¼Œèƒ½åšåˆ°`ZeroCopy`ï¼Œé‚£ä¹Ÿæ— å¯åšéï¼Œè€Œ`cache`å­˜å‚¨æŒ‡é’ˆç›´æ¥çœäº†é¢å¤–çš„éƒ¨åˆ†
- æœ‰çš„libraryç”šè‡³è¿˜åŒ…äº†serverï¼Œæ„Ÿè§‰å¿˜äº†åˆå¿ƒğŸ¤”ï¸ğŸ¤”ï¸ğŸ¤”ï¸ä½ çš„ç«å“æ˜¯memcacheã€rediså—ï¼Ÿè°ä¼šç”¨ï¼Ÿå› ä¸ºä½ å¿«ï¼Ÿ
- æˆ‘æ‰€å´‡å°šçš„â€œæš´åŠ›ç¾å­¦â€æ˜¯æç®€ï¼Œç¼ºé™·ç‡å’Œä»£ç é‡æˆæ­£æ¯”ï¼Œå¤æ‚çš„ä¸œè¥¿æ—©æ™šä¼šè¢«æ·˜æ±°ï¼Œ`KISS`æ‰æ˜¯ç‹é“ï¼Œ`cache`ä¸€å…±åªæœ‰ä¸åˆ°300è¡Œï¼Œåƒè¡Œbugç‡ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œå®ƒçš„bugä¸ä¼šå¤š

## å¸¸è§é—®é¢˜
> é—®ï¼šä¸€ä¸ªå®ä¾‹å¯ä»¥å­˜å‚¨å¤šç§å¯¹è±¡å—ï¼Ÿ
- ç­”ï¼šå¯ä»¥å‘€ï¼Œæ¯”å¦‚ç”¨å‰ç¼€æ ¼å¼åŒ–keyå°±å¯ä»¥äº†ï¼ˆåƒç”¨redisé‚£æ ·ï¼Œå†’å·åˆ†å‰²ï¼‰ï¼Œæ³¨æ„åˆ«æé”™ç±»å‹å°±å¥½ã€‚

> é—®ï¼šå¦‚ä½•ç»™ä¸åŒitemè®¾ç½®ä¸åŒè¿‡æœŸæ—¶é—´ï¼Ÿ
- ç­”ï¼šç”¨å¤šä¸ªç¼“å­˜å®ä¾‹ã€‚ï¼ˆğŸ˜„æ²¡æƒ³åˆ°å§ï¼‰

> é—®ï¼šå¦‚æœæœ‰çƒ­çƒ­çƒ­çƒ­keyé—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿ
- ç­”ï¼šæœ¬èº«ã€æœ¬åœ°å†…å­˜ç¼“å­˜ã€‘å°±æ˜¯ç”¨æ¥æŠ—çƒ­keyçš„ï¼Œè¿™é‡Œå¯ä»¥ç†è§£æˆæ˜¯éå¸¸éå¸¸çƒ­çš„keyï¼ˆå•æœºå‡ åä¸‡qpsï¼‰ï¼Œå®ƒä»¬æœ€å¤§çš„é—®é¢˜æ˜¯å¯¹å•ä¸€bucketé”å®šæ¬¡æ•°è¿‡å¤šï¼Œå½±å“åœ¨åŒä¸€ä¸ªbucketçš„å…¶ä»–æ•°æ®ã€‚é‚£ä¹ˆå¯ä»¥è¿™æ ·ï¼šä¸€æ˜¯æ”¹ç”¨`LFU-2`ä¸è®©ç±»ä¼¼éå†çš„è¯·æ±‚æŠŠçƒ­æ•°æ®åˆ·æ‰ï¼ŒäºŒæ˜¯é™¤äº†å¢åŠ bucketï¼Œå¯ä»¥ç”¨å¤šå®ä¾‹ï¼ˆåŒæ—¶å†™å…¥ç›¸åŒçš„itemï¼‰+è¯»éšæœºè®¿é—®æŸä¸€ä¸ªçš„æ–¹å¼ï¼Œè®©çƒ­keyæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œä¸è¿‡åˆ é™¤ï¼ˆåå†™ï¼‰çš„æ—¶å€™è¦æ³¨æ„å¤šå®ä¾‹å…¨éƒ¨åˆ é™¤ï¼Œé€‚ç”¨äºâ€œå†™å°‘è¯»éå¸¸å¤šâ€çš„åœºæ™¯ï¼Œæˆ–è€…â€œå†™å¤šè¯»å¤šâ€çš„åœºæ™¯å¯ä»¥æŠŠæœ‰å˜åŒ–çš„difféƒ¨åˆ†å•ç‹¬æ‘˜å‡ºæ¥è½¬åŒ–ä¸ºâ€œå†™å°‘è¯»å¤šâ€çš„åœºæ™¯ã€‚

> é—®ï¼šä¸ºä»€ä¹ˆä¸ç”¨è™šè¡¨å¤´æ–¹å¼å¤„ç†åŒé“¾è¡¨ï¼Ÿå¤ªå¼±äº†å§ï¼
- ç­”ï¼š2019-04-22æ³„æ¼çš„ã€[lrucache](http://github.com/orca-zhang/lrucache)ã€‘è¢«äººåœ¨Vç«™ä¸Šæ‰’å‡ºæ¥å–·è¿‡ï¼Œè¿˜çœŸä¸æ˜¯ä¸ä¼šï¼Œç°åœ¨çš„å†™æ³•ï¼Œè™½ç„¶æ¯”pointer-to-pointeræ–¹å¼è¯»èµ·æ¥ç»•è„‘ï¼Œä½†æ˜¯æœ‰20%å·¦å³çš„æå‡å“ˆï¼ï¼ˆğŸ˜„æ²¡æƒ³åˆ°å§ï¼‰

> é—®ï¼šä¸ºä»€ä¹ˆä¸æä¾›intç±»å‹çš„keyçš„æ¥å£ï¼Ÿ
- ç­”ï¼šè€ƒè™‘è¿‡ï¼Œä½†æ˜¯ä¸ºäº†åˆ†å¸ƒå¼ä¸€è‡´æ€§å¤„ç†çš„ç®€å•ï¼Œåªæä¾›stringçš„æ¥å£çœ‹ç€ä¹Ÿä¸é”™ï¼Œç”¨fmt.Sprint(i)ä¹Ÿä¸éº»çƒ¦ã€‚